# Flyway Autoddl

This is a simple POC to have DDL scripts automatically generated by Hibernate calculating the delta between the current state of the DB schema and the status of
Java objects annotated with `@Entity`.

## Example

Let us assume the `Dummy` entity is defined this way:

```java
// Current Entity State

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
@Table(name = "DUMMY")
public class Dummy {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "FOO")
    private int foo;
    
    ...
```

and a new column `BAR` needs to be added to the entity:

```java
// NEW Entity State

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity
@Table(name = "DUMMY")
public class Dummy {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "FOO")
    private int foo;

    @Column(name = "BAR", columnDefinition = "INTEGER")
    @Comment("I am just a nice comment")
    private int bar;
    
    ...
```

a new migration script will be generated with the following content:

```sql
alter table if exists dummy
    add column bar INTEGER;
```

## Caveats

The comment is not automatically added to the migration for whatever reason.


## Hibernate Envers

This branch works with `@Entity` objects annotated with `@Audited`. In case of the previous `Dummy` entity, if we were to add the `@Audited` annotation, then the following additional DDL will be generated:

```sql
    create table DUMMY_AUD (
       id int8 not null,
        REV int4 not null,
        REVTYPE int2,
        FOO int4,
        BAR int4,
        primary key (id, REV)
    );

    create table REVINFO (
       REV int4 not null,
        REVTSTMP int8,
        primary key (REV)
    );
```